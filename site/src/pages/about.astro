---
import Layout from '../layouts/Layout.astro';
import norwayData from '../../public/data/norway.json';

// Calculate data quality metrics
const projects = norwayData.projects;

// Data depth analysis
const dataDepthAnalysis = projects.map((p: any) => {
  const hasSize = p.size_sqm !== null;
  const hasBudget = p.budget !== null;
  const hasCircularity = p.metrics?.circularity_rate !== undefined;
  const hasCO2 = p.metrics?.co2_reduction !== undefined;
  const hasArchitect = p.architect !== null;
  const hasContractor = p.contractor !== null;
  const hasFeatures = p.circular_features?.length > 0;
  const hasSources = p.sources?.length > 0;

  const fieldsPresent = [hasSize, hasBudget, hasCircularity, hasCO2, hasArchitect, hasContractor, hasFeatures, hasSources].filter(Boolean).length;
  const completeness = Math.round((fieldsPresent / 8) * 100);

  return {
    id: p.id,
    name: p.name,
    dataQuality: p.data_quality,
    completeness,
    hasSize,
    hasBudget,
    hasCircularity,
    hasCO2,
    hasArchitect,
    hasContractor,
    hasFeatures,
    hasSources
  };
}).sort((a: any, b: any) => b.completeness - a.completeness);

const strongCount = projects.filter((p: any) => p.data_quality === 'strong').length;
const moderateCount = projects.filter((p: any) => p.data_quality === 'moderate').length;
const avgCompleteness = Math.round(dataDepthAnalysis.reduce((sum: number, p: any) => sum + p.completeness, 0) / projects.length);
---

<Layout title="About" description="About the Nordic Circular Buildings Database - documenting circular economy in construction">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="mb-12">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">About This Database</h1>
      <p class="text-lg text-gray-600">
        A research platform documenting circular building projects across the Nordic countries.
      </p>
    </div>

    <!-- Purpose -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Purpose</h2>
      <div class="prose prose-gray max-w-none">
        <p class="text-gray-600 mb-4">
          The Nordic Circular Buildings Database is an open research initiative to document and share knowledge
          about circular economy practices in the construction industry. Our goal is to:
        </p>
        <ul class="space-y-2 text-gray-600">
          <li class="flex items-start gap-2">
            <span class="text-nordic-500 mt-1">‚Ä¢</span>
            <span>Create a comprehensive inventory of circular building projects in Norway, Sweden, Denmark, Finland, and Iceland</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-nordic-500 mt-1">‚Ä¢</span>
            <span>Document material reuse strategies, metrics, and lessons learned</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-nordic-500 mt-1">‚Ä¢</span>
            <span>Provide verified data sources for researchers and practitioners</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-nordic-500 mt-1">‚Ä¢</span>
            <span>Track progress toward circular construction goals across the region</span>
          </li>
        </ul>
      </div>
    </section>

    <!-- Current Coverage -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Current Coverage</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-white rounded-xl border border-nordic-100 p-6">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-2xl">üá≥üá¥</span>
            <span class="font-semibold text-gray-900">Norway</span>
          </div>
          <div class="text-3xl font-bold text-nordic-600 mb-1">22</div>
          <div class="text-sm text-gray-500">Documented projects</div>
          <div class="mt-3 text-sm text-gray-600">
            Oslo (16), B√¶rum (2), Bergen (2), Asker (1), Trondheim (1)
          </div>
        </div>
        <div class="bg-stone-50 rounded-xl border border-stone-200 p-6">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-2xl">üá∏üá™üá©üá∞üá´üáÆüáÆüá∏</span>
            <span class="font-semibold text-gray-400">Coming Soon</span>
          </div>
          <div class="text-3xl font-bold text-gray-300 mb-1">‚Äî</div>
          <div class="text-sm text-gray-400">Sweden, Denmark, Finland, Iceland</div>
          <div class="mt-3 text-sm text-gray-400">
            Research in progress
          </div>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- RESEARCH METHODOLOGY -->
    <!-- ============================================ -->
    <section class="mb-12 bg-stone-50 rounded-xl p-6 border border-stone-200">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Research Methodology</h2>
      <div class="prose prose-gray max-w-none">
        <p class="text-gray-600 mb-4">
          This database was compiled through systematic research of 24 individual project documents (November 2024),
          supplemented by primary and secondary source verification.
        </p>

        <div class="bg-white rounded-lg p-4 mb-4 border border-stone-200">
          <h3 class="font-semibold text-gray-800 mb-2">Document Processing Method</h3>
          <ol class="space-y-2 text-gray-600 text-sm list-decimal list-inside">
            <li><strong>Source Collection:</strong> Research documents compiled from FutureBuilt reports, municipal project pages, architectural firm case studies, and news coverage</li>
            <li><strong>Data Extraction:</strong> Each document scanned for: budget figures, size specifications, material quantities, team members, CO‚ÇÇ metrics, circularity rates, and timeline data</li>
            <li><strong>Cross-Verification:</strong> Key figures verified against multiple sources where available (e.g., SINTEF research, contractor announcements, municipal budgets)</li>
            <li><strong>Structured Entry:</strong> Extracted data mapped to standardized JSON schema with source citations</li>
          </ol>
        </div>

        <div class="bg-white rounded-lg p-4 border border-stone-200">
          <h3 class="font-semibold text-gray-800 mb-2">Data Currency</h3>
          <ul class="space-y-1 text-gray-600 text-sm">
            <li>‚Ä¢ <strong>Last Research Update:</strong> November 30, 2024</li>
            <li>‚Ä¢ <strong>Documents Processed:</strong> 24 project-specific research files</li>
            <li>‚Ä¢ <strong>Primary Sources Verified:</strong> 38+ URLs checked</li>
            <li>‚Ä¢ <strong>Languages:</strong> Norwegian (primary), English (secondary)</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- CIRCULARITY CALCULATION METHODOLOGY -->
    <!-- ============================================ -->
    <section class="mb-12 bg-nordic-50 rounded-xl p-6 border border-nordic-100">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">How Circularity is Calculated</h2>
      <div class="prose prose-gray max-w-none">
        <p class="text-gray-600 mb-4">
          Circularity percentages in this database come from <strong>project-reported figures</strong> using established methodologies.
          We do not calculate these values ourselves; we report what projects have measured and documented.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div class="bg-white rounded-lg p-4 border border-nordic-200">
            <h3 class="font-semibold text-nordic-700 mb-2">FutureBuilt Circularity Index</h3>
            <p class="text-sm text-gray-600 mb-2">
              Used by FutureBuilt pilot projects. Measures percentage of materials by weight that are:
            </p>
            <ul class="text-sm text-gray-600 space-y-1">
              <li>‚Ä¢ Reused from existing buildings</li>
              <li>‚Ä¢ Made from recycled content</li>
              <li>‚Ä¢ Designed for future disassembly</li>
              <li>‚Ä¢ From renewable/bio-based sources</li>
            </ul>
            <div class="mt-2 text-xs text-gray-500">
              <strong>Example:</strong> Prosjekt F√∏niks reports 89% circularity index
            </div>
          </div>

          <div class="bg-white rounded-lg p-4 border border-nordic-200">
            <h3 class="font-semibold text-nordic-700 mb-2">Material Reuse Rate</h3>
            <p class="text-sm text-gray-600 mb-2">
              Simpler metric measuring reused materials as percentage of total:
            </p>
            <ul class="text-sm text-gray-600 space-y-1">
              <li>‚Ä¢ Weight of reused materials √∑ Total material weight</li>
              <li>‚Ä¢ May include recycled content</li>
              <li>‚Ä¢ Often reported "by weight" or "by volume"</li>
            </ul>
            <div class="mt-2 text-xs text-gray-500">
              <strong>Example:</strong> KA13 reports 80% reuse by weight
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg p-4 border border-nordic-200">
          <h3 class="font-semibold text-amber-700 mb-2">‚ö†Ô∏è Important Caveats</h3>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ <strong>No universal standard:</strong> Different projects may use different calculation methods</li>
            <li>‚Ä¢ <strong>Self-reported:</strong> Figures come from project teams, not independent auditors</li>
            <li>‚Ä¢ <strong>Scope varies:</strong> Some include structure only, others include all materials</li>
            <li>‚Ä¢ <strong>Verification levels differ:</strong> Some verified by SINTEF/BREEAM, others unverified</li>
          </ul>
        </div>

        <div class="mt-4 p-3 bg-nordic-100 rounded-lg">
          <p class="text-sm text-nordic-800">
            <strong>Our approach:</strong> We report the project's stated figures with their measurement basis
            (e.g., "by weight", "preliminary", "target") so users can assess comparability.
          </p>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- DATA QUALITY STANDARDS -->
    <!-- ============================================ -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Data Quality Standards</h2>
      <p class="text-gray-600 mb-4">
        Each project is assigned a data quality rating based on source availability and verification:
      </p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-nordic-50 rounded-lg p-4 border border-nordic-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-1 bg-nordic-100 text-nordic-700 rounded text-xs font-medium">Strong</span>
            <span class="text-sm text-gray-500">{strongCount} projects</span>
          </div>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ Multiple verified primary sources</li>
            <li>‚Ä¢ Official project reports available</li>
            <li>‚Ä¢ Key metrics independently confirmed</li>
          </ul>
        </div>
        <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs font-medium">Moderate</span>
            <span class="text-sm text-gray-500">{moderateCount} projects</span>
          </div>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ Some primary sources available</li>
            <li>‚Ä¢ Key information from news/interviews</li>
            <li>‚Ä¢ Some metrics unverified</li>
          </ul>
        </div>
        <div class="bg-red-50 rounded-lg p-4 border border-red-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium">Limited</span>
            <span class="text-sm text-gray-500">0 projects</span>
          </div>
          <ul class="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ Few sources available</li>
            <li>‚Ä¢ Information incomplete</li>
            <li>‚Ä¢ Requires further research</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- INFORMATION DEPTH MATRIX -->
    <!-- ============================================ -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Information Depth by Project</h2>
      <p class="text-gray-600 mb-4">
        Current data completeness across all 22 projects. Average completeness: <strong>{avgCompleteness}%</strong>
      </p>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="text-left py-2 px-2 font-medium text-gray-700">Project</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Size (m¬≤)">Size</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Budget">Budget</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Circularity %">Circ.</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="CO‚ÇÇ Reduction">CO‚ÇÇ</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Architect">Arch.</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Contractor">Contr.</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Features">Feat.</th>
              <th class="text-center py-2 px-1 font-medium text-gray-500" title="Sources">Src.</th>
              <th class="text-right py-2 px-2 font-medium text-gray-700">Complete</th>
            </tr>
          </thead>
          <tbody>
            {dataDepthAnalysis.map((p: any) => (
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="py-2 px-2">
                  <a href={`${import.meta.env.BASE_URL}project/${p.id}/`} class="text-nordic-600 hover:text-nordic-700">
                    {p.name.length > 25 ? p.name.substring(0, 25) + '...' : p.name}
                  </a>
                </td>
                <td class="text-center py-2 px-1">{p.hasSize ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasBudget ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasCircularity ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasCO2 ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasArchitect ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasContractor ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasFeatures ? '‚úì' : '‚Äî'}</td>
                <td class="text-center py-2 px-1">{p.hasSources ? '‚úì' : '‚Äî'}</td>
                <td class="text-right py-2 px-2">
                  <span class={`px-2 py-0.5 rounded text-xs font-medium ${
                    p.completeness >= 75 ? 'bg-nordic-100 text-nordic-700' :
                    p.completeness >= 50 ? 'bg-amber-100 text-amber-700' :
                    'bg-red-100 text-red-700'
                  }`}>
                    {p.completeness}%
                  </span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      <p class="text-xs text-gray-500 mt-3">
        ‚úì = Data available | ‚Äî = Missing or unknown | Columns: Size, Budget, Circularity Rate, CO‚ÇÇ Reduction, Architect, Contractor, Features, Sources
      </p>
    </section>

    <!-- Data Sources -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Data Sources</h2>
      <p class="text-gray-600 mb-4">
        Project data is compiled from verified public sources including:
      </p>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
        <a href="https://www.futurebuilt.no" target="_blank" rel="noopener" class="bg-white rounded-lg border border-gray-200 p-3 hover:border-nordic-300 transition-colors">
          <div class="text-sm font-medium text-gray-900">FutureBuilt</div>
          <div class="text-xs text-gray-500">futurebuilt.no</div>
        </a>
        <a href="https://www.entra.no" target="_blank" rel="noopener" class="bg-white rounded-lg border border-gray-200 p-3 hover:border-nordic-300 transition-colors">
          <div class="text-sm font-medium text-gray-900">Entra ASA</div>
          <div class="text-xs text-gray-500">entra.no</div>
        </a>
        <a href="https://www.statsbygg.no" target="_blank" rel="noopener" class="bg-white rounded-lg border border-gray-200 p-3 hover:border-nordic-300 transition-colors">
          <div class="text-sm font-medium text-gray-900">Statsbygg</div>
          <div class="text-xs text-gray-500">statsbygg.no</div>
        </a>
        <a href="https://doga.no" target="_blank" rel="noopener" class="bg-white rounded-lg border border-gray-200 p-3 hover:border-nordic-300 transition-colors">
          <div class="text-sm font-medium text-gray-900">DOGA</div>
          <div class="text-xs text-gray-500">doga.no</div>
        </a>
        <a href="https://www.sintef.no" target="_blank" rel="noopener" class="bg-white rounded-lg border border-gray-200 p-3 hover:border-nordic-300 transition-colors">
          <div class="text-sm font-medium text-gray-900">SINTEF</div>
          <div class="text-xs text-gray-500">sintef.no</div>
        </a>
        <a href="https://ressurssentral.no" target="_blank" rel="noopener" class="bg-white rounded-lg border border-gray-200 p-3 hover:border-nordic-300 transition-colors">
          <div class="text-sm font-medium text-gray-900">Ressurssentral</div>
          <div class="text-xs text-gray-500">ressurssentral.no</div>
        </a>
      </div>
    </section>

    <!-- Circular Strategies -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Circular Strategies Tracked</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-white rounded-lg border border-gray-200 p-4">
          <div class="font-medium text-gray-900 mb-2">Material Reuse</div>
          <p class="text-sm text-gray-600">Salvaging and reusing building materials from demolition or renovation projects in new construction.</p>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 p-4">
          <div class="font-medium text-gray-900 mb-2">Adaptive Reuse</div>
          <p class="text-sm text-gray-600">Repurposing existing buildings for new uses rather than demolishing and building new.</p>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 p-4">
          <div class="font-medium text-gray-900 mb-2">Upcycling</div>
          <p class="text-sm text-gray-600">Transforming waste materials or by-products into new materials of higher quality or value.</p>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 p-4">
          <div class="font-medium text-gray-900 mb-2">Design for Disassembly</div>
          <p class="text-sm text-gray-600">Designing buildings to be easily deconstructed for future material reuse.</p>
        </div>
      </div>
    </section>

    <!-- Metrics -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Key Metrics</h2>
      <p class="text-gray-600 mb-4">
        We track several key performance indicators for circular buildings:
      </p>
      <div class="space-y-3">
        <div class="flex items-start gap-3">
          <div class="w-24 flex-shrink-0 text-sm font-medium text-nordic-600">Circularity Rate</div>
          <div class="text-sm text-gray-600">Percentage of materials by weight that are reused, recycled, or from circular sources</div>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-24 flex-shrink-0 text-sm font-medium text-nordic-600">CO‚ÇÇ Reduction</div>
          <div class="text-sm text-gray-600">Greenhouse gas emissions saved compared to conventional construction</div>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-24 flex-shrink-0 text-sm font-medium text-nordic-600">Material Sources</div>
          <div class="text-sm text-gray-600">Documentation of donor buildings and material origins</div>
        </div>
      </div>
    </section>

    <!-- Open Source -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Open Data</h2>
      <p class="text-gray-600 mb-4">
        All project data is available as open JSON files for research and analysis:
      </p>
      <div class="bg-stone-50 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
          <span class="font-mono text-sm text-gray-700">/data/norway.json</span>
          <a
            href={`${import.meta.env.BASE_URL}/data/norway.json`}
            target="_blank"
            class="px-3 py-1.5 bg-nordic-500 text-white rounded-lg text-sm font-medium hover:bg-nordic-600 transition-colors"
          >
            Download JSON
          </a>
        </div>
        <p class="text-sm text-gray-500">
          Contains all 22 Norwegian projects with full metadata, metrics, and source citations.
        </p>
      </div>
    </section>

    <!-- Contribute -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Contribute</h2>
      <p class="text-gray-600 mb-4">
        This is an open-source project. Contributions are welcome:
      </p>
      <a
        href="https://github.com/justaride/nordic-circular-buildings"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
        </svg>
        View on GitHub
      </a>
    </section>
  </div>
</Layout>
